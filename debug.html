<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é™¤éŒ¯é é¢ - ç„¡éšœç¤™å»æ‰€GO V2</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .debug-container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .debug-item {
            margin: 10px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: #f9f9f9;
        }
        .success { border-color: #4CAF50; background-color: #f1f8e9; }
        .error { border-color: #f44336; background-color: #ffebee; }
        .warning { border-color: #ff9800; background-color: #fff3e0; }
        .info { border-color: #2196F3; background-color: #e3f2fd; }
        pre {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 12px;
        }
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .btn-success { background: #4CAF50; color: white; }
        .btn-primary { background: #2196F3; color: white; }
        .btn-warning { background: #ff9800; color: white; }
    </style>
</head>
<body>
    <div class="debug-container">
        <h1>ğŸ” é™¤éŒ¯é é¢</h1>
        <p>æ­¤é é¢ç”¨æ–¼è©³ç´°è¨ºæ–· JavaScript æœå‹™è¼‰å…¥å’Œåˆå§‹åŒ–å•é¡Œã€‚</p>
        
        <div style="margin: 20px 0;">
            <button class="btn-primary" onclick="runFullDiagnostic()">ğŸ” å®Œæ•´è¨ºæ–·</button>
            <button class="btn-warning" onclick="testInitialization()">âš¡ æ¸¬è©¦åˆå§‹åŒ–</button>
            <button class="btn-success" onclick="window.location.href='index.html'">ğŸ  å›åˆ°é¦–é </button>
        </div>
        
        <div id="debug-results">
            <div class="debug-item info">
                <strong>â³ æº–å‚™é€²è¡Œè¨ºæ–·...</strong>
            </div>
        </div>
    </div>

    <!-- è¼‰å…¥æ‰€æœ‰ JavaScript æª”æ¡ˆ -->
    <script src="js/config.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/api.js"></script>
    <script src="js/map.js"></script>
    <script src="js/accessibility.js"></script>
    <script src="js/navigation.js"></script>
    <script src="js/search.js"></script>
    <script src="js/main.js"></script>
    
    <script>
        let debugResults = document.getElementById('debug-results');
        
        function addDebugItem(message, type = 'info', details = null) {
            const div = document.createElement('div');
            div.className = `debug-item ${type}`;
            
            let content = `<strong>${message}</strong>`;
            if (details) {
                content += `<pre>${details}</pre>`;
            }
            
            div.innerHTML = content;
            debugResults.appendChild(div);
        }
        
        function runFullDiagnostic() {
            debugResults.innerHTML = '';
            addDebugItem('ğŸ” é–‹å§‹å®Œæ•´è¨ºæ–·...', 'info');
            
            // 1. æª¢æŸ¥ window ç‰©ä»¶
            setTimeout(() => {
                checkWindowObjects();
            }, 100);
            
            // 2. æª¢æŸ¥æœå‹™é¡åˆ¥
            setTimeout(() => {
                checkServiceClasses();
            }, 200);
            
            // 3. æª¢æŸ¥æœå‹™å¯¦ä¾‹
            setTimeout(() => {
                checkServiceInstances();
            }, 300);
            
            // 4. æª¢æŸ¥æ–¹æ³•
            setTimeout(() => {
                checkMethods();
            }, 400);
            
            // 5. æ¸¬è©¦åˆå§‹åŒ–
            setTimeout(() => {
                testInitialization();
            }, 500);
        }
        
        function checkWindowObjects() {
            addDebugItem('ğŸ“‹ æª¢æŸ¥ Window ç‰©ä»¶ä¸­çš„æœå‹™...', 'info');
            
            const services = [
                'CONFIG', 'Utils', 'APIService', 'AccessibilityService', 
                'NavigationService', 'SearchService', 'MapService', 'App'
            ];
            
            services.forEach(service => {
                if (window[service]) {
                    addDebugItem(`âœ… ${service} å­˜åœ¨æ–¼ window ç‰©ä»¶`, 'success', 
                        `é¡å‹: ${typeof window[service]}, å»ºæ§‹å‡½æ•¸: ${window[service].constructor?.name || 'N/A'}`);
                } else {
                    addDebugItem(`âŒ ${service} ä¸å­˜åœ¨æ–¼ window ç‰©ä»¶`, 'error');
                    
                    // æª¢æŸ¥æ˜¯å¦åœ¨è¼‰å…¥ä¸­
                    if (service === 'CONFIG') {
                        addDebugItem(`   ğŸ” æª¢æŸ¥ CONFIG ç‰©ä»¶...`, 'warning');
                        // ç­‰å¾…ä¸€ä¸‹å†æª¢æŸ¥
                        setTimeout(() => {
                            if (window.CONFIG) {
                                addDebugItem(`   âœ… CONFIG å»¶é²è¼‰å…¥æˆåŠŸ`, 'success');
                            } else {
                                addDebugItem(`   âŒ CONFIG ä»ç„¶ä¸å­˜åœ¨`, 'error');
                            }
                        }, 1000);
                    }
                }
            });
        }
        
        function checkServiceClasses() {
            addDebugItem('ğŸ—ï¸ æª¢æŸ¥æœå‹™é¡åˆ¥å®šç¾©...', 'info');
            
            try {
                // æª¢æŸ¥é¡åˆ¥æ˜¯å¦å­˜åœ¨
                if (typeof AccessibilityService !== 'undefined') {
                    addDebugItem('âœ… AccessibilityService é¡åˆ¥å·²å®šç¾©', 'success');
                } else {
                    addDebugItem('âŒ AccessibilityService é¡åˆ¥æœªå®šç¾©', 'error');
                }
                
                if (typeof NavigationService !== 'undefined') {
                    addDebugItem('âœ… NavigationService é¡åˆ¥å·²å®šç¾©', 'success');
                } else {
                    addDebugItem('âŒ NavigationService é¡åˆ¥æœªå®šç¾©', 'error');
                }
                
                if (typeof SearchService !== 'undefined') {
                    addDebugItem('âœ… SearchService é¡åˆ¥å·²å®šç¾©', 'success');
                } else {
                    addDebugItem('âŒ SearchService é¡åˆ¥æœªå®šç¾©', 'error');
                }
                
                if (typeof MapService !== 'undefined') {
                    addDebugItem('âœ… MapService é¡åˆ¥å·²å®šç¾©', 'success');
                } else {
                    addDebugItem('âŒ MapService é¡åˆ¥æœªå®šç¾©', 'error');
                }
            } catch (error) {
                addDebugItem(`âŒ æª¢æŸ¥é¡åˆ¥æ™‚ç™¼ç”ŸéŒ¯èª¤: ${error.message}`, 'error', error.stack);
            }
        }
        
        function checkServiceInstances() {
            addDebugItem('ğŸ”§ æª¢æŸ¥æœå‹™å¯¦ä¾‹...', 'info');
            
            const instances = [
                'window.AccessibilityService',
                'window.NavigationService', 
                'window.SearchService',
                'window.MapService'
            ];
            
            instances.forEach(instance => {
                try {
                    const service = eval(instance);
                    if (service) {
                        addDebugItem(`âœ… ${instance} å¯¦ä¾‹å­˜åœ¨`, 'success', 
                            `é¡å‹: ${typeof service}, å»ºæ§‹å‡½æ•¸: ${service.constructor.name}`);
                    } else {
                        addDebugItem(`âŒ ${instance} å¯¦ä¾‹ä¸å­˜åœ¨`, 'error');
                    }
                } catch (error) {
                    addDebugItem(`âŒ ${instance} æª¢æŸ¥å¤±æ•—: ${error.message}`, 'error');
                }
            });
        }
        
        function checkMethods() {
            addDebugItem('âš™ï¸ æª¢æŸ¥æœå‹™æ–¹æ³•...', 'info');
            
            const methodChecks = [
                { service: 'window.AccessibilityService', method: 'initialize' },
                { service: 'window.NavigationService', method: 'initialize' },
                { service: 'window.SearchService', method: 'initialize' },
                { service: 'window.MapService', method: 'initialize' }
            ];
            
            methodChecks.forEach(check => {
                try {
                    const service = eval(check.service);
                    if (service && typeof service[check.method] === 'function') {
                        addDebugItem(`âœ… ${check.service}.${check.method} æ–¹æ³•å­˜åœ¨`, 'success');
                    } else {
                        addDebugItem(`âŒ ${check.service}.${check.method} æ–¹æ³•ä¸å­˜åœ¨æˆ–ä¸æ˜¯å‡½æ•¸`, 'error', 
                            `æœå‹™é¡å‹: ${typeof service}, æ–¹æ³•é¡å‹: ${typeof service ? typeof service[check.method] : 'undefined'}`);
                    }
                } catch (error) {
                    addDebugItem(`âŒ ${check.service}.${check.method} æª¢æŸ¥å¤±æ•—: ${error.message}`, 'error');
                }
            });
        }
        
        function testInitialization() {
            addDebugItem('ğŸš€ æ¸¬è©¦æœå‹™åˆå§‹åŒ–...', 'info');
            
            // æ¸¬è©¦ç„¡éšœç¤™æœå‹™
            try {
                if (window.AccessibilityService && typeof window.AccessibilityService.initialize === 'function') {
                    window.AccessibilityService.initialize();
                    addDebugItem('âœ… AccessibilityService åˆå§‹åŒ–æˆåŠŸ', 'success');
                } else {
                    addDebugItem('âŒ AccessibilityService åˆå§‹åŒ–å¤±æ•— - æœå‹™æˆ–æ–¹æ³•ä¸å­˜åœ¨', 'error');
                }
            } catch (error) {
                addDebugItem(`âŒ AccessibilityService åˆå§‹åŒ–éŒ¯èª¤: ${error.message}`, 'error', error.stack);
            }
            
            // æ¸¬è©¦å°èˆªæœå‹™
            try {
                if (window.NavigationService && typeof window.NavigationService.initialize === 'function') {
                    window.NavigationService.initialize();
                    addDebugItem('âœ… NavigationService åˆå§‹åŒ–æˆåŠŸ', 'success');
                } else {
                    addDebugItem('âŒ NavigationService åˆå§‹åŒ–å¤±æ•— - æœå‹™æˆ–æ–¹æ³•ä¸å­˜åœ¨', 'error');
                }
            } catch (error) {
                addDebugItem(`âŒ NavigationService åˆå§‹åŒ–éŒ¯èª¤: ${error.message}`, 'error', error.stack);
            }
            
            // æ¸¬è©¦æœå°‹æœå‹™
            try {
                if (window.SearchService && typeof window.SearchService.initialize === 'function') {
                    window.SearchService.initialize();
                    addDebugItem('âœ… SearchService åˆå§‹åŒ–æˆåŠŸ', 'success');
                } else {
                    addDebugItem('âŒ SearchService åˆå§‹åŒ–å¤±æ•— - æœå‹™æˆ–æ–¹æ³•ä¸å­˜åœ¨', 'error');
                }
            } catch (error) {
                addDebugItem(`âŒ SearchService åˆå§‹åŒ–éŒ¯èª¤: ${error.message}`, 'error', error.stack);
            }
            
            // æ¸¬è©¦åœ°åœ–æœå‹™
            try {
                if (window.MapService) {
                    addDebugItem('âœ… MapService è¼‰å…¥æˆåŠŸ', 'success');
                } else {
                    addDebugItem('âŒ MapService è¼‰å…¥å¤±æ•—', 'error');
                }
            } catch (error) {
                addDebugItem(`âŒ MapService è¼‰å…¥éŒ¯èª¤: ${error.message}`, 'error', error.stack);
            }
            
            addDebugItem('ğŸ¯ åˆå§‹åŒ–æ¸¬è©¦å®Œæˆ', 'info');
        }
        
        // é é¢è¼‰å…¥å®Œæˆå¾Œè‡ªå‹•é–‹å§‹è¨ºæ–·
        window.addEventListener('load', () => {
            setTimeout(() => {
                runFullDiagnostic();
            }, 500);
        });
    </script>
</body>
</html>
